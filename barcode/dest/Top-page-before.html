<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Top page</title>
    <meta charset="utf-8" />
    <meta name="description" content="Top page" />
    <meta name="keywords" content="Top page" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no, maximum-scale=1, user-scalable=no" />
    <link href="https://fonts.googleapis.com/css2?family=Raleway:ital,wght@0,400;0,700;1,400;1,700&amp;display=swap" rel="stylesheet" />
    <link rel="icon" href="/favicon.ico" />
    <link rel="stylesheet" href="css/main.css" />
    <link rel="stylesheet" href="css/pages/top-page-before.css" />
  </head>
  <body>
    <header class="header">
      <div class="header-default">
        <div class="tablet-container">
          <div class="header__content d-flex align-items-center justify-content-between">
            <div class="header__left">
              <button class="btn header__toggle js-toggle-menu"><i class="icon icon--list"></i>
              </button>
            </div>
            <div class="header__text">CONCIERGE CARTE</div>
            <div class="header__right d-flex justify-content-end">
              <button class="btn btn--white-outline btn--sm header__qrcode js-header-qrcode" data-toggle="modal" data-target=".modal-qr" data-staff="199144"><i class="icon icon--qrcode"></i><span class="btn-text">QR表示</span>
              </button>
            </div>
          </div>
        </div>
      </div>
      <ul class="menu-list" id="menu-list">
        <li class="menu-list__item"><a class="menu-list__link d-flex justify-content-between align-items-center active" href="#">
            <div class="menu-list__link-content"><span>トップ</span></div><i class="icon icon--next"></i>
          </a>
        </li>
        <li class="menu-list__item"><a class="menu-list__link d-flex justify-content-between align-items-center" href="#">
            <div class="menu-list__link-content"><span>マイ顧客台帳</span></div><i class="icon icon--next"></i>
          </a>
        </li>
        <li class="menu-list__item"><a class="menu-list__link d-flex justify-content-between align-items-center" href="#">
            <div class="menu-list__link-content"><span>ログアウト</span></div><i class="icon icon--next"></i>
          </a>
        </li>
        <li class="menu-list__item"><a class="menu-list__link d-flex justify-content-between align-items-center" href="#">
            <div class="menu-list__link-content"><span>管理者メニュー</span></div><i class="icon icon--next"></i>
          </a>
        </li>
        <li class="menu-list__item menu-list__item--title">管理者メニュー</li>
        <li class="menu-list__item"><a class="menu-list__link d-flex justify-content-between align-items-center" href="#">
            <div class="menu-list__link-content"><span>設定メッセージ検索</span></div><i class="icon icon--next"></i>
          </a>
        </li>
        <li class="menu-list__item"><a class="menu-list__link d-flex justify-content-between align-items-center" href="#">
            <div class="menu-list__link-content"><span>FS一覧・登録</span></div><i class="icon icon--next"></i>
          </a>
        </li>
        <li class="menu-list__item"><a class="menu-list__link d-flex justify-content-between align-items-center" href="#">
            <div class="menu-list__link-content"><span>テンプレートメッセージ一覧・登録</span></div><i class="icon icon--next"></i>
          </a>
        </li>
        <li class="menu-list__item"><a class="menu-list__link d-flex justify-content-between align-items-center" href="#">
            <div class="menu-list__link-content"><span>カード一覧・登録</span></div><i class="icon icon--next"></i>
          </a>
        </li>
        <li class="menu-list__item"><a class="menu-list__link d-flex justify-content-between align-items-center" href="#">
            <div class="menu-list__link-content"><span>シリーズ一覧・登録</span></div><i class="icon icon--next"></i>
          </a>
        </li>
      </ul>
      <div class="header-overlay"></div>
      <div class="modal modal-qr fade" tabindex="-1" role="dialog" aria-hidden="true">
        <div class="modal-dialog modal__dialog modal-dialog-centered" role="document">
          <div class="modal-content modal__content">
            <button class="modal__close close" type="button" data-dismiss="modal" aria-label="Close"><i class="icon icon--close"></i>
            </button>
            <div class="modal-body modal__body">
              <div id="qrcode"></div>
            </div>
          </div>
        </div>
      </div>
    </header>
    <div class="wrapper">
      <div class="main-content top-page">
        <div class="top-page__content">
          <div class="page-title text-center">ルミネ新宿店</div>
          <div class="top-page__staff"><img class="top-page__avatar" src="./images/avatar1.png" alt="avatar">
            <div class="top-page__name">伊藤</div>
          </div>
          <div class="top-page__button"><a class="top-page__scan" href="#" data-toggle="modal" data-target=".modal-barcode"><i class="icon icon--barcode"></i><span class="top-page__button-text">会員バーコードカメラ読み込み</span></a><a class="top-page__id" href="#"><i class="icon icon--users"></i><span class="top-page__button-text">会員ID登録</span></a></div>
        </div>
      </div>
    </div>
    <div class="modal modal-barcode">
      <div class="modal-dialog modal__dialog modal-dialog-centered" role="document">
        <div class="modal-content modal__content">
          <button class="modal__close close" type="button" data-dismiss="modal" aria-label="Close"><i class="icon icon--close"></i></button>
          <div class="modal-body modal__body p-4">
            <div class="text-center">
              <video class="barcode-frame p-3" id="video" width="450" height="450" style="border: 1px solid #dee2e6"></video>
            </div>
          </div>
          <div class="form-group text-center d-none">
            <button id ="modal-error" class="btn btn--red btn--md auth__button mt-1"><span class="btn-text" data-toggle="modal" data-target=".modal-error">modal error</span></button>
          </div>
          <div class="modal-footer border-0 d-none">
            <form class="auth__form w-100 px-3" action="/admin/conciergeqr/input_real_shop_card_no" method="post">
              <div class="form-group form-group--large">
                <label class="form-group__label"><span class="form-group__label-text">&#x7D50;&#x679C;</span></label>
                <input class="form-control form-control--input form-control--lg form-control--full" id="scanner_input" name="real_shop_card_no" type="text">
              </div>
              <div class="form-group text-center">
                <button id="barcode-submit" class="btn btn--red btn--md auth__button mt-1"><span class="btn-text">&#x767B;&#x9332;</span></button>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>
    <div class="modal modal-error">
      <div class="modal-dialog modal__dialog modal-dialog-centered" role="document">
        <div class="modal-content modal__content">
          <button class="modal__close close" type="button" data-dismiss="modal" aria-label="Close"><i class="icon icon--close"></i></button>
          <div class="modal-body modal__body p-4">
            <div class="text-center">
              text erorr
            </div>
            <button class="btn btn--red btn--md auth__button mt-1" type="button" data-dismiss="modal" aria-label="Close"><span class="btn-text">OK</span></button>
          </div>
        </div>
      </div>
    </div>
    <script type="text/javascript" src="js/main.js"></script>
    <script type="text/javascript" src="https://unpkg.com/@zxing/library@latest"></script>
    <script type="text/javascript">
        window.addEventListener('load', function()
        {
          $('.modal-barcode').on('shown.bs.modal', function () {
            let selectedDeviceId;
            const codeReader = new ZXing.BrowserMultiFormatReader()
            console.log('ZXing code reader initialized')
            codeReader.listVideoInputDevices()
              .then((videoInputDevices) =>
              {
                console.log('after then')
                  codeReader.decodeFromVideoDevice(selectedDeviceId, 'video', (result, err) =>
                  {
                    if (result)
                    {
                      console.log(result)
                      document.getElementById('scanner_input').value = result.text
                      document.getElementById('video').style.borderColor = 'green';
                      $('#barcode-submit').trigger('click')
                    }
                    if (err && !(err instanceof ZXing.NotFoundException))
                    {
                      console.error(err)
                      document.getElementById('scanner_input').textContent = err
                      $('#modal-error').trigger('click')
                    }
                  })
                  console.log(`Started continous decode from camera with id ${selectedDeviceId}`)
              })
              .catch((err) =>
              {
                console.error(err)
              })
          })
      })
    </script>
  </body>
</html>
